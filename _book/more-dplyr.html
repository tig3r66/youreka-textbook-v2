<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 More dplyr | A Gentle Introduction to Data Science with R</title>
  <meta name="description" content="6 More dplyr | A Gentle Introduction to Data Science with R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 More dplyr | A Gentle Introduction to Data Science with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="assets/youreka-logo.png" />
  
  <meta name="github-repo" content="tig3r66/youreka-textbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 More dplyr | A Gentle Introduction to Data Science with R" />
  
  
  <meta name="twitter:image" content="assets/youreka-logo.png" />

<meta name="author" content="Eddie Guo" />
<meta name="author" content="Youreka Canada Programs Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gapminder-and-dplyr.html"/>
<link rel="next" href="central-limit-theorem.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.1/iframeResizer.min.js">
</script>

<script type="text/javascript">

// Once page is loaded, override and disable popover "scroll into view"
  $(document).ready(function() {
    window.tutorial.scrollIntoView = function() {}
  })

// Add padding to LearnR body when popover shown
  $(document).on("shown.bs.popover", function() {
    var popoverHeight = document.querySelector(".popover").offsetHeight
    document.body.style.paddingTop = popoverHeight + 10 + "px"
  })

// Set padding to 0 when popover hidden
  $(document).on("hide.bs.popover", function() {
    var popoverHeight = document.querySelector(".popover").offsetHeight
    document.body.style.paddingTop = "0px"
  })
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="assets/youreka-logo.png" ></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Youreka Canada</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-textbook"><i class="fa fa-check"></i>How to use this textbook</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#credit"><i class="fa fa-check"></i>Credit</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="part"><span><b>I Prerequisites</b></span></li>
<li class="chapter" data-level="1" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>1</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="install.html"><a href="install.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="install.html"><a href="install.html#installing-rstudio"><i class="fa fa-check"></i><b>1.2</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="install.html"><a href="install.html#add-on-packages"><i class="fa fa-check"></i><b>1.3</b> Add-on packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>2</b> Intro to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro-to-r.html"><a href="intro-to-r.html#objects"><i class="fa fa-check"></i><b>2.1</b> Objects</a></li>
<li class="chapter" data-level="2.2" data-path="intro-to-r.html"><a href="intro-to-r.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
<li class="chapter" data-level="2.3" data-path="intro-to-r.html"><a href="intro-to-r.html#math-operators"><i class="fa fa-check"></i><b>2.3</b> Math operators</a></li>
<li class="chapter" data-level="2.4" data-path="intro-to-r.html"><a href="intro-to-r.html#conditionals"><i class="fa fa-check"></i><b>2.4</b> Conditionals</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro-to-r.html"><a href="intro-to-r.html#if-statements"><i class="fa fa-check"></i><b>2.4.1</b> If statements</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro-to-r.html"><a href="intro-to-r.html#working-directory"><i class="fa fa-check"></i><b>2.5</b> Working directory</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="intro-to-r.html"><a href="intro-to-r.html#other-important-things"><i class="fa fa-check"></i><b>2.5.1</b> Other important things</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>3</b> Data Structures</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>3.1</b> Vectors</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-structures.html"><a href="data-structures.html#missing-values"><i class="fa fa-check"></i><b>3.1.1</b> Missing values</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>3.2</b> Lists</a></li>
<li class="chapter" data-level="3.3" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>3.3</b> Data frames</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-structures.html"><a href="data-structures.html#external-data"><i class="fa fa-check"></i><b>3.3.1</b> External data</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-structures.html"><a href="data-structures.html#factors"><i class="fa fa-check"></i><b>3.3.2</b> Factors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="loops-and-functions.html"><a href="loops-and-functions.html"><i class="fa fa-check"></i><b>4</b> Loops and Functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="loops-and-functions.html"><a href="loops-and-functions.html#for-loops"><i class="fa fa-check"></i><b>4.1</b> For loops</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="loops-and-functions.html"><a href="loops-and-functions.html#looping-over-multiple-files"><i class="fa fa-check"></i><b>4.1.1</b> Looping over multiple files</a></li>
<li class="chapter" data-level="4.1.2" data-path="loops-and-functions.html"><a href="loops-and-functions.html#nested-loops"><i class="fa fa-check"></i><b>4.1.2</b> Nested loops</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="loops-and-functions.html"><a href="loops-and-functions.html#functions-1"><i class="fa fa-check"></i><b>4.2</b> Functions</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="loops-and-functions.html"><a href="loops-and-functions.html#conditionals-within-functions"><i class="fa fa-check"></i><b>4.2.1</b> Conditionals within functions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Wrangling</b></span></li>
<li class="chapter" data-level="5" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html"><i class="fa fa-check"></i><b>5</b> Gapminder and dplyr</a>
<ul>
<li class="chapter" data-level="5.1" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#get-the-gapminder-data"><i class="fa fa-check"></i><b>5.1</b> Get the gapminder data</a></li>
<li class="chapter" data-level="5.2" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#explore-gapminder"><i class="fa fa-check"></i><b>5.2</b> Explore gapminder</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#importing-and-exporting-data"><i class="fa fa-check"></i><b>5.2.1</b> Importing and exporting data</a></li>
<li class="chapter" data-level="5.2.2" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#exploring-variables-in-a-data-frame"><i class="fa fa-check"></i><b>5.2.2</b> Exploring variables in a data frame</a></li>
<li class="chapter" data-level="5.2.3" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#data-frame-summary"><i class="fa fa-check"></i><b>5.2.3</b> Data frame summary</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#data-frames-with-dplyr"><i class="fa fa-check"></i><b>5.3</b> Data frames with dplyr</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#subsetting-data"><i class="fa fa-check"></i><b>5.3.1</b> Subsetting data</a></li>
<li class="chapter" data-level="5.3.2" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>5.3.2</b> Filter rows with <code>filter()</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#pipe-operator"><i class="fa fa-check"></i><b>5.3.3</b> Pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="5.3.4" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#select-columns-with-select"><i class="fa fa-check"></i><b>5.3.4</b> Select Columns with <code>select()</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#pure-predictable-pipeable-optional"><i class="fa fa-check"></i><b>5.3.5</b> Pure, predictable, pipeable (OPTIONAL)</a></li>
<li class="chapter" data-level="5.3.6" data-path="gapminder-and-dplyr.html"><a href="gapminder-and-dplyr.html#additional-resources"><i class="fa fa-check"></i><b>5.3.6</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="more-dplyr.html"><a href="more-dplyr.html"><i class="fa fa-check"></i><b>6</b> More dplyr</a>
<ul>
<li class="chapter" data-level="6.1" data-path="more-dplyr.html"><a href="more-dplyr.html#review-and-preparation"><i class="fa fa-check"></i><b>6.1</b> Review and preparation</a></li>
<li class="chapter" data-level="6.2" data-path="more-dplyr.html"><a href="more-dplyr.html#use-mutate-to-add-new-variables"><i class="fa fa-check"></i><b>6.2</b> Use mutate() to add new variables</a></li>
<li class="chapter" data-level="6.3" data-path="more-dplyr.html"><a href="more-dplyr.html#use-arrange-to-row-order-data"><i class="fa fa-check"></i><b>6.3</b> Use arrange() to row-order data</a></li>
<li class="chapter" data-level="6.4" data-path="more-dplyr.html"><a href="more-dplyr.html#use-rename-to-rename-variables"><i class="fa fa-check"></i><b>6.4</b> Use rename() to rename variables</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="more-dplyr.html"><a href="more-dplyr.html#use-select-to-rename-and-reposition-variables"><i class="fa fa-check"></i><b>6.4.1</b> Use select() to rename and reposition variables</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="more-dplyr.html"><a href="more-dplyr.html#perform-tasks-on-subsets-with-group_by"><i class="fa fa-check"></i><b>6.5</b> Perform tasks on subsets with <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="more-dplyr.html"><a href="more-dplyr.html#counting"><i class="fa fa-check"></i><b>6.5.1</b> Counting</a></li>
<li class="chapter" data-level="6.5.2" data-path="more-dplyr.html"><a href="more-dplyr.html#general-summarization"><i class="fa fa-check"></i><b>6.5.2</b> General summarization</a></li>
<li class="chapter" data-level="6.5.3" data-path="more-dplyr.html"><a href="more-dplyr.html#computing-with-group-wise-summaries"><i class="fa fa-check"></i><b>6.5.3</b> Computing with group-wise summaries</a></li>
<li class="chapter" data-level="6.5.4" data-path="more-dplyr.html"><a href="more-dplyr.html#window-functions-optional"><i class="fa fa-check"></i><b>6.5.4</b> Window functions (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="more-dplyr.html"><a href="more-dplyr.html#introduction-to-visualization-optional"><i class="fa fa-check"></i><b>6.6</b> Introduction to visualization (OPTIONAL)</a></li>
<li class="chapter" data-level="6.7" data-path="more-dplyr.html"><a href="more-dplyr.html#comprehensive-practice"><i class="fa fa-check"></i><b>6.7</b> Comprehensive practice</a></li>
<li class="chapter" data-level="6.8" data-path="more-dplyr.html"><a href="more-dplyr.html#data-wrangling-summary"><i class="fa fa-check"></i><b>6.8</b> Data wrangling summary</a></li>
</ul></li>
<li class="part"><span><b>III Statistics</b></span></li>
<li class="chapter" data-level="7" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html"><i class="fa fa-check"></i><b>7</b> Central limit theorem</a>
<ul>
<li class="chapter" data-level="7.1" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#clt-for-means"><i class="fa fa-check"></i><b>7.1</b> CLT for means</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#clt-part-1"><i class="fa fa-check"></i><b>7.1.1</b> CLT Part 1</a></li>
<li class="chapter" data-level="7.1.2" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#clt-part-2"><i class="fa fa-check"></i><b>7.1.2</b> CLT Part 2</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#clt-for-proportions"><i class="fa fa-check"></i><b>7.2</b> CLT for proportions</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html"><i class="fa fa-check"></i><b>8</b> Basic statistical tests</a>
<ul>
<li class="chapter" data-level="8.1" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#getting-ready"><i class="fa fa-check"></i><b>8.1</b> Getting ready</a></li>
<li class="chapter" data-level="8.2" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#students-t-test"><i class="fa fa-check"></i><b>8.2</b> Student’s t-test</a></li>
<li class="chapter" data-level="8.3" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi-squared-test"><i class="fa fa-check"></i><b>8.3</b> Chi-squared test</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-goodness-of-fit"><i class="fa fa-check"></i><b>8.3.1</b> <span class="math inline">\(\chi^2\)</span> test for goodness-of-fit</a></li>
<li class="chapter" data-level="8.3.2" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-independence"><i class="fa fa-check"></i><b>8.3.2</b> <span class="math inline">\(\chi^2\)</span> test for independence</a></li>
<li class="chapter" data-level="8.3.3" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-homogeneity"><i class="fa fa-check"></i><b>8.3.3</b> <span class="math inline">\(\chi^2\)</span> test for homogeneity</a></li>
<li class="chapter" data-level="8.3.4" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#fishers-exact-test-optional"><i class="fa fa-check"></i><b>8.3.4</b> Fisher’s exact test (OPTIONAL)</a></li>
<li class="chapter" data-level="8.3.5" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#comparison-of-proportions-optional"><i class="fa fa-check"></i><b>8.3.5</b> Comparison of proportions (OPTIONAL)</a></li>
<li class="chapter" data-level="8.3.6" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#contingency-tables"><i class="fa fa-check"></i><b>8.3.6</b> Contingency tables</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#visualizing-data-distributions-optional"><i class="fa fa-check"></i><b>8.4</b> Visualizing data distributions (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html"><i class="fa fa-check"></i><b>9</b> Comparing multiple means</a>
<ul>
<li class="chapter" data-level="9.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#loading-packages"><i class="fa fa-check"></i><b>9.1</b> Loading packages</a></li>
<li class="chapter" data-level="9.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#merging-datasets"><i class="fa fa-check"></i><b>9.2</b> Merging datasets</a></li>
<li class="chapter" data-level="9.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#one-way-anova"><i class="fa fa-check"></i><b>9.3</b> One-way ANOVA</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#the-iris-dataset"><i class="fa fa-check"></i><b>9.3.1</b> The iris dataset</a></li>
<li class="chapter" data-level="9.3.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#non-parametric-alternatives-to-anova"><i class="fa fa-check"></i><b>9.3.2</b> Non-parametric alternatives to ANOVA</a></li>
<li class="chapter" data-level="9.3.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#two-way-anova"><i class="fa fa-check"></i><b>9.3.3</b> Two-way ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#linear-regression"><i class="fa fa-check"></i><b>9.4</b> Linear regression</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#basic-concepts"><i class="fa fa-check"></i><b>9.4.1</b> Basic concepts</a></li>
<li class="chapter" data-level="9.4.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#pearson-correlation"><i class="fa fa-check"></i><b>9.4.2</b> Pearson correlation</a></li>
<li class="chapter" data-level="9.4.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#spearman-correlation"><i class="fa fa-check"></i><b>9.4.3</b> Spearman correlation</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Data Visualization</b></span></li>
<li class="chapter" data-level="10" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html"><i class="fa fa-check"></i><b>10</b> Data visualization basics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html#a-graphing-template"><i class="fa fa-check"></i><b>10.1</b> A graphing template</a></li>
<li class="chapter" data-level="10.2" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html#scatter-plot"><i class="fa fa-check"></i><b>10.2</b> Scatter plot</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html#trend-lines"><i class="fa fa-check"></i><b>10.2.1</b> Trend lines</a></li>
<li class="chapter" data-level="10.2.2" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html#facets"><i class="fa fa-check"></i><b>10.2.2</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="data-visualization-basics.html"><a href="data-visualization-basics.html#aesthetic-mappings"><i class="fa fa-check"></i><b>10.3</b> Aesthetic mappings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html"><i class="fa fa-check"></i><b>11</b> Getting publication-ready</a>
<ul>
<li class="chapter" data-level="11.1" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#line-plot"><i class="fa fa-check"></i><b>11.1</b> Line plot</a></li>
<li class="chapter" data-level="11.2" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#bar-plot"><i class="fa fa-check"></i><b>11.2</b> Bar plot</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#basics"><i class="fa fa-check"></i><b>11.2.1</b> Basics</a></li>
<li class="chapter" data-level="11.2.2" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#plotting-significance-optional"><i class="fa fa-check"></i><b>11.2.2</b> Plotting significance (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#box-plot"><i class="fa fa-check"></i><b>11.3</b> Box plot</a></li>
<li class="chapter" data-level="11.4" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#histogram-and-density-plot"><i class="fa fa-check"></i><b>11.4</b> Histogram and density plot</a></li>
<li class="chapter" data-level="11.5" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#assembly-of-multiple-figures-optional"><i class="fa fa-check"></i><b>11.5</b> Assembly of multiple figures (OPTIONAL)</a></li>
<li class="chapter" data-level="11.6" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#extras-optional"><i class="fa fa-check"></i><b>11.6</b> Extras (OPTIONAL)</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#choropleth"><i class="fa fa-check"></i><b>11.6.1</b> Choropleth</a></li>
<li class="chapter" data-level="11.6.2" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#animations"><i class="fa fa-check"></i><b>11.6.2</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="getting-publication-ready.html"><a href="getting-publication-ready.html#additional-resources-1"><i class="fa fa-check"></i><b>11.7</b> Additional resources</a></li>
</ul></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#license">
    License: CC-BY-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Gentle Introduction to Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="more-dplyr" class="section level1" number="6">
<h1><span class="header-section-number">6</span> More dplyr</h1>
<div id="review-and-preparation" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Review and preparation</h2>
<p>In the previous chapter, we introduced three important data wrangling concepts:</p>
<ol style="list-style-type: decimal">
<li><code>filter()</code> for subsetting rows</li>
<li><code>select()</code> for subsetting columns (i.e., variables)</li>
<li>The pipe operator <code>%&gt;%</code>, which feeds the left-hand side as the first argument to the expression on the right-hand side</li>
</ol>
<p>We also discussed dplyr’s role inside the tidyverse and tibbles:</p>
<ul>
<li><code>dplyr</code> is a core package in the <a href="https://github.com/hadley/tidyverse">tidyverse</a> meta-package. Since we often make incidental usage of the others, we will load dplyr and the others via <code>library(tidyverse)</code>.</li>
<li>The <code>tidyverse</code> embraces a special flavor of data frame, called a tibble. The <code>gapminder</code> dataset is stored as a tibble.</li>
</ul>
<p>Let’s load the tidyverse and gapminder.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="more-dplyr.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb147-2"><a href="more-dplyr.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span></code></pre></div>
<p>We’re going to make changes to the <code>gapminder</code> tibble. To eliminate any fear that you’re damaging the data that comes with the package, let’s create an explicit copy of <code>gapminder</code> for our experiments. Don’t worry if you modify the gapminder package, since your changes are temporary (i.e., you can reload the gapminder to get a fresh dataset).</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="more-dplyr.html#cb148-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="ot">&lt;-</span> gapminder</span></code></pre></div>
<p><strong>Pay close attention</strong> when we evaluate statements but let the output just print to screen…</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="more-dplyr.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="do">## let output print to screen, but do not store</span></span>
<span id="cb149-2"><a href="more-dplyr.html#cb149-2" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Canada&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##    country continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Canada  Americas   1952    68.8 14785584    11367.
##  2 Canada  Americas   1957    70.0 17010154    12490.
##  3 Canada  Americas   1962    71.3 18985849    13462.
##  4 Canada  Americas   1967    72.1 20819767    16077.
##  5 Canada  Americas   1972    72.9 22284500    18971.
##  6 Canada  Americas   1977    74.2 23796400    22091.
##  7 Canada  Americas   1982    75.8 25201900    22899.
##  8 Canada  Americas   1987    76.9 26549700    26627.
##  9 Canada  Americas   1992    78.0 28523502    26343.
## 10 Canada  Americas   1997    78.6 30305843    28955.
## 11 Canada  Americas   2002    79.8 31902268    33329.
## 12 Canada  Americas   2007    80.7 33390141    36319.</code></pre>
<p>… versus when we assign the output to a new variable, or overwritting one that already exists.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="more-dplyr.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="do">## store the output as an R object</span></span>
<span id="cb151-2"><a href="more-dplyr.html#cb151-2" aria-hidden="true" tabindex="-1"></a>my_precious <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Canada&quot;</span>)</span></code></pre></div>
</div>
<div id="use-mutate-to-add-new-variables" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Use mutate() to add new variables</h2>
<p>Imagine we wanted to recover each country’s GDP. After all, the Gapminder data has a variable for population and GDP per capita. Let’s multiply them together to get the GDP of the whole country.</p>
<p>The <code>mutate()</code> function defines and inserts new variables into a data frame/tibble. You can refer to existing variables by name.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="more-dplyr.html#cb152-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gdp =</span> pop <span class="sc">*</span> gdpPercap)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##    country     continent  year lifeExp      pop gdpPercap          gdp
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.
##  2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.
##  3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.
##  4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.
##  5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.
##  6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.
##  7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.
##  8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.
##  9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.
## 10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.
## # … with 1,694 more rows</code></pre>
<p>If you don’t want to add a new column to your tibble, you can use <code>transmute()</code>. It works just like <code>mutate()</code> except it only keeps the column(s) you specify.</p>
<p>Let’s save our output in a new tibble called <code>gap_gdp</code>. Recall that saving the return of functions generally suppresses printing to the console. If you want to see the output, either type or print the variable.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="more-dplyr.html#cb154-1" aria-hidden="true" tabindex="-1"></a>gap_gdp <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(country, <span class="at">gdp =</span> pop <span class="sc">*</span> gdpPercap)</span>
<span id="cb154-2"><a href="more-dplyr.html#cb154-2" aria-hidden="true" tabindex="-1"></a>gap_gdp  <span class="co"># or use print(gap_gdp)</span></span></code></pre></div>
<pre><code>## # A tibble: 1,704 x 2
##    country              gdp
##    &lt;fct&gt;              &lt;dbl&gt;
##  1 Afghanistan  6567086330.
##  2 Afghanistan  7585448670.
##  3 Afghanistan  8758855797.
##  4 Afghanistan  9648014150.
##  5 Afghanistan  9678553274.
##  6 Afghanistan 11697659231.
##  7 Afghanistan 12598563401.
##  8 Afghanistan 11820990309.
##  9 Afghanistan 10595901589.
## 10 Afghanistan 14121995875.
## # … with 1,694 more rows</code></pre>
<p>Hmmm… those GDP numbers are almost uselessly large and abstract. Consider the <a href="http://fivethirtyeight.com/datalab/xkcd-randall-munroe-qanda-what-if/">advice of Randall Munroe of xkcd</a>:</p>
<blockquote>
<p>One thing that bothers me is large numbers presented without context… ‘If I added a zero to this number, would the sentence containing it mean something different to me?’ If the answer is ‘no,’ maybe the number has no business being in the sentence in the first place."</p>
</blockquote>
<p>Maybe it would be more meaningful to consumers of my tables and figures to stick with GDP per capita. But what if I reported GDP per capita, <em>relative to some benchmark country</em>. Since Canada is my home country, I’ll go with that.</p>
<p>I need to create a new variable that is <code>gdpPercap</code> divided by Canadian <code>gdpPercap</code>, taking care that I always divide two numbers that pertain to the same year.</p>
<p>Here is what we need to do:</p>
<ol style="list-style-type: decimal">
<li>Filter down to the rows for Canada.</li>
<li>Create a new temporary variable in <code>my_gap</code>:
<ol style="list-style-type: lower-alpha">
<li>Extract the <code>gdpPercap</code> variable from the Canadian data.</li>
<li>Replicate it once per country in the dataset, so it has the right length.</li>
</ol></li>
<li>Divide raw <code>gdpPercap</code> by this Canadian figure.</li>
<li>Discard the temporary variable of replicated Canadian <code>gdpPercap</code>.</li>
</ol>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="more-dplyr.html#cb156-1" aria-hidden="true" tabindex="-1"></a>ctib <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Canada&quot;</span>)</span>
<span id="cb156-2"><a href="more-dplyr.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this is a semi-dangerous way to add this variable</span></span>
<span id="cb156-3"><a href="more-dplyr.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="do">## I&#39;d prefer to join on year, but we haven&#39;t covered joins yet</span></span>
<span id="cb156-4"><a href="more-dplyr.html#cb156-4" aria-hidden="true" tabindex="-1"></a>my_gap <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span></span>
<span id="cb156-5"><a href="more-dplyr.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tmp =</span> <span class="fu">rep</span>(ctib<span class="sc">$</span>gdpPercap, <span class="fu">nlevels</span>(country)),</span>
<span id="cb156-6"><a href="more-dplyr.html#cb156-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">gdpPercapRel =</span> gdpPercap <span class="sc">/</span> tmp,</span>
<span id="cb156-7"><a href="more-dplyr.html#cb156-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tmp =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Note that, <code>mutate()</code> builds new variables sequentially so you can reference earlier ones (like <code>tmp</code>) when defining later ones (like <code>gdpPercapRel</code>). Also, you can get rid of a variable by setting it to <code>NULL</code>.</p>
<p>How could we sanity check that this worked? The Canadian values for <code>gdpPercapRel</code> better all be 1!</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="more-dplyr.html#cb157-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="more-dplyr.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Canada&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb157-3"><a href="more-dplyr.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, gdpPercapRel)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    country  year gdpPercapRel
##    &lt;fct&gt;   &lt;int&gt;        &lt;dbl&gt;
##  1 Canada   1952            1
##  2 Canada   1957            1
##  3 Canada   1962            1
##  4 Canada   1967            1
##  5 Canada   1972            1
##  6 Canada   1977            1
##  7 Canada   1982            1
##  8 Canada   1987            1
##  9 Canada   1992            1
## 10 Canada   1997            1
## 11 Canada   2002            1
## 12 Canada   2007            1</code></pre>
<p>I perceive Canada to be a “high GDP” country, so I predict that the distribution of <code>gdpPercapRel</code> is located below 1, possibly even well below. Check your intuition!</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="more-dplyr.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_gap<span class="sc">$</span>gdpPercapRel)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.007236 0.061648 0.171521 0.326659 0.446564 9.534690</code></pre>
<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Canada, across the entire time period.</p>
<p>Remember: Trust No One. Including (especially?) yourself. Always try to find a way to check that you’ve done what meant to. Prepare to be horrified.</p>
</div>
<div id="use-arrange-to-row-order-data" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Use arrange() to row-order data</h2>
<p>The <code>arrange()</code> function reorders rows in a data frame/tibble. Imagine you wanted this data ordered by year then country, as opposed to by country then year. Remember, to save the output, you must assign it to a variable.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="more-dplyr.html#cb161-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(year, country)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##    country     continent  year lifeExp      pop gdpPercap gdpPercapRel
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.       0.0686
##  2 Albania     Europe     1952    55.2  1282697     1601.       0.141 
##  3 Algeria     Africa     1952    43.1  9279525     2449.       0.215 
##  4 Angola      Africa     1952    30.0  4232095     3521.       0.310 
##  5 Argentina   Americas   1952    62.5 17876956     5911.       0.520 
##  6 Australia   Oceania    1952    69.1  8691212    10040.       0.883 
##  7 Austria     Europe     1952    66.8  6927772     6137.       0.540 
##  8 Bahrain     Asia       1952    50.9   120447     9867.       0.868 
##  9 Bangladesh  Asia       1952    37.5 46886859      684.       0.0602
## 10 Belgium     Europe     1952    68    8730405     8343.       0.734 
## # … with 1,694 more rows</code></pre>
<p>Or maybe you want just the data from 2007, sorted on life expectancy?</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="more-dplyr.html#cb163-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb163-2"><a href="more-dplyr.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="more-dplyr.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lifeExp)</span></code></pre></div>
<pre><code>## # A tibble: 142 x 7
##    country                continent  year lifeExp     pop gdpPercap gdpPercapRel
##    &lt;fct&gt;                  &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Swaziland              Africa     2007    39.6  1.13e6     4513.       0.124 
##  2 Mozambique             Africa     2007    42.1  2.00e7      824.       0.0227
##  3 Zambia                 Africa     2007    42.4  1.17e7     1271.       0.0350
##  4 Sierra Leone           Africa     2007    42.6  6.14e6      863.       0.0237
##  5 Lesotho                Africa     2007    42.6  2.01e6     1569.       0.0432
##  6 Angola                 Africa     2007    42.7  1.24e7     4797.       0.132 
##  7 Zimbabwe               Africa     2007    43.5  1.23e7      470.       0.0129
##  8 Afghanistan            Asia       2007    43.8  3.19e7      975.       0.0268
##  9 Central African Repub… Africa     2007    44.7  4.37e6      706.       0.0194
## 10 Liberia                Africa     2007    45.7  3.19e6      415.       0.0114
## # … with 132 more rows</code></pre>
<p>Oh, you’d like to sort on life expectancy in <strong>desc</strong>ending order? Then use <code>desc()</code>.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="more-dplyr.html#cb165-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="more-dplyr.html#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="more-dplyr.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 142 x 7
##    country          continent  year lifeExp       pop gdpPercap gdpPercapRel
##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 Japan            Asia       2007    82.6 127467972    31656.        0.872
##  2 Hong Kong, China Asia       2007    82.2   6980412    39725.        1.09 
##  3 Iceland          Europe     2007    81.8    301931    36181.        0.996
##  4 Switzerland      Europe     2007    81.7   7554661    37506.        1.03 
##  5 Australia        Oceania    2007    81.2  20434176    34435.        0.948
##  6 Spain            Europe     2007    80.9  40448191    28821.        0.794
##  7 Sweden           Europe     2007    80.9   9031088    33860.        0.932
##  8 Israel           Asia       2007    80.7   6426679    25523.        0.703
##  9 France           Europe     2007    80.7  61083916    30470.        0.839
## 10 Canada           Americas   2007    80.7  33390141    36319.        1    
## # … with 132 more rows</code></pre>
<p>I advise that your analyses NEVER rely on rows or variables being in a specific order. But it’s still true that human beings write the code and the interactive development process can be much nicer if you reorder the rows of your data as you go along. Also, once you are preparing tables for human eyeballs, it is imperative that you step up and take control of row order.</p>
</div>
<div id="use-rename-to-rename-variables" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Use rename() to rename variables</h2>
<p>When I started programming, I was a <a href="http://en.wikipedia.org/wiki/CamelCase">camelCase</a> person, but now I’m all about <a href="http://en.wikipedia.org/wiki/Snake_case">snake_case</a>. Let’s rename some variables!</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="more-dplyr.html#cb167-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="more-dplyr.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">life_exp =</span> lifeExp,</span>
<span id="cb167-3"><a href="more-dplyr.html#cb167-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">gdp_percap =</span> gdpPercap,</span>
<span id="cb167-4"><a href="more-dplyr.html#cb167-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">gdp_percap_rel =</span> gdpPercapRel)</span></code></pre></div>
<pre><code>## # A tibble: 1,704 x 7
##    country     continent  year life_exp      pop gdp_percap gdp_percap_rel
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;
##  1 Afghanistan Asia       1952     28.8  8425333       779.         0.0686
##  2 Afghanistan Asia       1957     30.3  9240934       821.         0.0657
##  3 Afghanistan Asia       1962     32.0 10267083       853.         0.0634
##  4 Afghanistan Asia       1967     34.0 11537966       836.         0.0520
##  5 Afghanistan Asia       1972     36.1 13079460       740.         0.0390
##  6 Afghanistan Asia       1977     38.4 14880372       786.         0.0356
##  7 Afghanistan Asia       1982     39.9 12881816       978.         0.0427
##  8 Afghanistan Asia       1987     40.8 13867957       852.         0.0320
##  9 Afghanistan Asia       1992     41.7 16317921       649.         0.0246
## 10 Afghanistan Asia       1997     41.8 22227415       635.         0.0219
## # … with 1,694 more rows</code></pre>
<p>I did NOT assign the post-rename object back to <code>my_gap</code> because that would make the chunks in this tutorial harder to copy/paste and run out of order. In real life, I would probably assign this back to <code>my_gap</code>, in a data preparation script, and proceed with the new variable names.</p>
<div id="use-select-to-rename-and-reposition-variables" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Use select() to rename and reposition variables</h3>
<p>You’ve seen simple uses of <code>select()</code>. There are two tricks you might enjoy:</p>
<ol style="list-style-type: decimal">
<li><code>select()</code> can rename the variables you request to keep.</li>
<li><code>select()</code> can be used with <code>everything()</code> to hoist a variable up to the front of the tibble.</li>
</ol>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="more-dplyr.html#cb169-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="more-dplyr.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Burundi&quot;</span>, year <span class="sc">&gt;</span> <span class="dv">1996</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="more-dplyr.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">yr =</span> year, lifeExp, gdpPercap) <span class="sc">%&gt;%</span> </span>
<span id="cb169-4"><a href="more-dplyr.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gdpPercap, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   gdpPercap    yr lifeExp
##       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1      463.  1997    45.3
## 2      446.  2002    47.4
## 3      430.  2007    49.6</code></pre>
<p><code>everything()</code> is one of several helpers for variable selection. Read the documentation to see the rest.</p>
</div>
</div>
<div id="perform-tasks-on-subsets-with-group_by" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Perform tasks on subsets with <code>group_by()</code></h2>
<p>I have found collaborators love to ask seemingly innocuous questions like, “which country experienced the sharpest 5-year drop in life expectancy?” In fact, that is a totally natural question to ask. But if you are using a language that doesn’t know about data, it’s an incredibly annoying question to answer.</p>
<p><code>dplyr</code> offers powerful tools to solve this class of problem.</p>
<ul>
<li><code>group_by()</code> adds extra structure to your dataset – grouping information – which lays the groundwork for computations within the groups.</li>
<li><code>summarize()</code> takes a dataset with <span class="math inline">\(n\)</span> observations, computes requested summaries, and returns a dataset with 1 observation.</li>
<li>Window functions take a dataset with <span class="math inline">\(n\)</span> observations and return a dataset with <span class="math inline">\(n\)</span> observations.</li>
<li>You can also do very general computations on your groups with <code>do()</code>.</li>
</ul>
<p>Combined with the verbs you already know, these new tools allow you to solve an extremely diverse set of problems with relative ease.</p>
<div id="counting" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Counting</h3>
<p>Let’s start with simple counting. How many observations do we have per continent? The <code>n()</code> function counts the number of observations in a particular group.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="more-dplyr.html#cb171-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="more-dplyr.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="more-dplyr.html#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##   &lt;fct&gt;     &lt;int&gt;
## 1 Africa      624
## 2 Americas    300
## 3 Asia        396
## 4 Europe      360
## 5 Oceania      24</code></pre>
<p>Let us pause here to think about the <code>tidyverse</code>. You could get these same frequencies using <code>table()</code> from base R.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="more-dplyr.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gapminder<span class="sc">$</span>continent)</span></code></pre></div>
<pre><code>## 
##   Africa Americas     Asia   Europe  Oceania 
##      624      300      396      360       24</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="more-dplyr.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">table</span>(gapminder<span class="sc">$</span>continent))</span></code></pre></div>
<pre><code>##  &#39;table&#39; int [1:5(1d)] 624 300 396 360 24
##  - attr(*, &quot;dimnames&quot;)=List of 1
##   ..$ : chr [1:5] &quot;Africa&quot; &quot;Americas&quot; &quot;Asia&quot; &quot;Europe&quot; ...</code></pre>
<p>But the object of class <code>table</code> that is returned makes downstream computation a bit fiddlier than we would like. For example, it’s too bad the continent levels come back only as <em>names</em> and not as a proper factor, with the original set of levels.</p>
<p>The <code>tally()</code> function is a convenient function that counts rows.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="more-dplyr.html#cb177-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb177-2"><a href="more-dplyr.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb177-3"><a href="more-dplyr.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##   &lt;fct&gt;     &lt;int&gt;
## 1 Africa      624
## 2 Americas    300
## 3 Asia        396
## 4 Europe      360
## 5 Oceania      24</code></pre>
<p>The <code>count()</code> function is an even more convenient function that does both grouping and counting.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="more-dplyr.html#cb179-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span> <span class="fu">count</span>(continent)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent     n
##   &lt;fct&gt;     &lt;int&gt;
## 1 Africa      624
## 2 Americas    300
## 3 Asia        396
## 4 Europe      360
## 5 Oceania      24</code></pre>
<p>What if we wanted to add the number of unique countries for each continent? You can compute multiple summaries inside <code>summarize()</code>. Use the <code>n_distinct()</code> function to count the number of distinct countries within each continent.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="more-dplyr.html#cb181-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb181-2"><a href="more-dplyr.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="more-dplyr.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb181-4"><a href="more-dplyr.html#cb181-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_countries =</span> <span class="fu">n_distinct</span>(country))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   continent     n n_countries
##   &lt;fct&gt;     &lt;int&gt;       &lt;int&gt;
## 1 Africa      624          52
## 2 Americas    300          25
## 3 Asia        396          33
## 4 Europe      360          30
## 5 Oceania      24           2</code></pre>
</div>
<div id="general-summarization" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> General summarization</h3>
<p>The functions you’ll apply within <code>summarize()</code> include classical statistical summaries, like <code>mean()</code>, <code>median()</code>, <code>var()</code>, <code>sd()</code>, <code>mad()</code>, <code>IQR()</code>, <code>min()</code>, and <code>max()</code>. Remember they are functions that take <span class="math inline">\(n\)</span> inputs and distill them down into 1 output.</p>
<p>Although this may be statistically ill-advised, let’s compute the average life expectancy by continent.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="more-dplyr.html#cb183-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb183-2"><a href="more-dplyr.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb183-3"><a href="more-dplyr.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_lifeExp =</span> <span class="fu">mean</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   continent avg_lifeExp
##   &lt;fct&gt;           &lt;dbl&gt;
## 1 Africa           48.9
## 2 Americas         64.7
## 3 Asia             60.1
## 4 Europe           71.9
## 5 Oceania          74.3</code></pre>
<p><code>summarize_at()</code> applies the same summary function(s) to multiple variables. Let’s compute average and median life expectancy and GDP per capita by continent by year … but only for 1952 and 2007.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="more-dplyr.html#cb185-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb185-2"><a href="more-dplyr.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1952</span>, <span class="dv">2007</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="more-dplyr.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="more-dplyr.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_at</span>(<span class="fu">vars</span>(lifeExp, gdpPercap), <span class="fu">funs</span>(mean, median))</span></code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   continent [5]
##    continent  year lifeExp_mean gdpPercap_mean lifeExp_median gdpPercap_median
##    &lt;fct&gt;     &lt;int&gt;        &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;
##  1 Africa     1952         39.1          1253.           38.8             987.
##  2 Africa     2007         54.8          3089.           52.9            1452.
##  3 Americas   1952         53.3          4079.           54.7            3048.
##  4 Americas   2007         73.6         11003.           72.9            8948.
##  5 Asia       1952         46.3          5195.           44.9            1207.
##  6 Asia       2007         70.7         12473.           72.4            4471.
##  7 Europe     1952         64.4          5661.           65.9            5142.
##  8 Europe     2007         77.6         25054.           78.6           28054.
##  9 Oceania    1952         69.3         10298.           69.3           10298.
## 10 Oceania    2007         80.7         29810.           80.7           29810.</code></pre>
<p>Let’s focus just on Asia. What are the minimum and maximum life expectancies seen by year?</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="more-dplyr.html#cb187-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb187-2"><a href="more-dplyr.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb187-3"><a href="more-dplyr.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb187-4"><a href="more-dplyr.html#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min_lifeExp =</span> <span class="fu">min</span>(lifeExp), <span class="at">max_lifeExp =</span> <span class="fu">max</span>(lifeExp))</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##     year min_lifeExp max_lifeExp
##    &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1952        28.8        65.4
##  2  1957        30.3        67.8
##  3  1962        32.0        69.4
##  4  1967        34.0        71.4
##  5  1972        36.1        73.4
##  6  1977        31.2        75.4
##  7  1982        39.9        77.1
##  8  1987        40.8        78.7
##  9  1992        41.7        79.4
## 10  1997        41.8        80.7
## 11  2002        42.1        82  
## 12  2007        43.8        82.6</code></pre>
<p>Of course it would be much more interesting to see <em>which</em> country contributed these extreme observations. Is the minimum (maximum) always coming from the same country?We will tackle this with window functions shortly.</p>
</div>
<div id="computing-with-group-wise-summaries" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Computing with group-wise summaries</h3>
<p>Don’t worry too much about this section if all the data wrangling is starting to become overwhelming – it’s mainly here for the curious.</p>
<p>Let’s make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. We group by country and use <code>mutate()</code> to make a new variable. The <code>first()</code> function extracts the first value from a vector. Notice that <code>first()</code> is operating on the vector of life expectancies <em>within each country group</em>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="more-dplyr.html#cb189-1" aria-hidden="true" tabindex="-1"></a>new_var <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span></span>
<span id="cb189-2"><a href="more-dplyr.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb189-3"><a href="more-dplyr.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lifeExp) <span class="sc">%&gt;%</span> </span>
<span id="cb189-4"><a href="more-dplyr.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lifeExp_gain =</span> lifeExp <span class="sc">-</span> <span class="fu">first</span>(lifeExp)) <span class="sc">%&gt;%</span> </span>
<span id="cb189-5"><a href="more-dplyr.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1963</span>)</span>
<span id="cb189-6"><a href="more-dplyr.html#cb189-6" aria-hidden="true" tabindex="-1"></a>new_var</span></code></pre></div>
<pre><code>## # A tibble: 426 x 4
## # Groups:   country [142]
##    country      year lifeExp lifeExp_gain
##    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afghanistan  1952    28.8         0   
##  2 Afghanistan  1957    30.3         1.53
##  3 Afghanistan  1962    32.0         3.20
##  4 Albania      1952    55.2         0   
##  5 Albania      1957    59.3         4.05
##  6 Albania      1962    64.8         9.59
##  7 Algeria      1952    43.1         0   
##  8 Algeria      1957    45.7         2.61
##  9 Algeria      1962    48.3         5.23
## 10 Angola       1952    30.0         0   
## # … with 416 more rows</code></pre>
<p>Within country, we take the difference between life expectancy in year <span class="math inline">\(i\)</span> and life expectancy in 1952. Therefore we always see zeroes for 1952 and, for most countries, a sequence of positive and increasing numbers.</p>
</div>
<div id="window-functions-optional" class="section level3" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Window functions (OPTIONAL)</h3>
<p>Window functions take <span class="math inline">\(n\)</span> inputs and give back <span class="math inline">\(n\)</span> outputs. Furthermore, the output depends on all the values. So <code>rank()</code> is a window function but <code>sum()</code> is not. Here we use window functions based on ranks and offsets.</p>
<p>Let’s revisit the worst and best life expectancies in Asia over time, but retaining info about <em>which</em> country contributes these extreme values.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="more-dplyr.html#cb191-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb191-2"><a href="more-dplyr.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="more-dplyr.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb191-4"><a href="more-dplyr.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb191-5"><a href="more-dplyr.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">min_rank</span>(<span class="fu">desc</span>(lifeExp)) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">|</span> <span class="fu">min_rank</span>(lifeExp) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb191-6"><a href="more-dplyr.html#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span></code></pre></div>
<pre><code>## # A tibble: 24 x 3
## # Groups:   year [12]
##     year country     lifeExp
##    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;
##  1  1952 Afghanistan    28.8
##  2  1952 Israel         65.4
##  3  1957 Afghanistan    30.3
##  4  1957 Israel         67.8
##  5  1962 Afghanistan    32.0
##  6  1962 Israel         69.4
##  7  1967 Afghanistan    34.0
##  8  1967 Japan          71.4
##  9  1972 Afghanistan    36.1
## 10  1972 Japan          73.4
## # … with 14 more rows</code></pre>
<p>We see that (min = Afghanistan, max = Japan) is the most frequent result, but Cambodia and Israel pop up at least once each as the min or max, respectively. That table should make you impatient for our upcoming work on tidying and reshaping data! Wouldn’t it be nice to have one row per year?</p>
<p>How did that actually work? First, I store and view a partial that leaves off the <code>filter()</code> statement. All of these operations should be familiar.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="more-dplyr.html#cb193-1" aria-hidden="true" tabindex="-1"></a>asia <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span></span>
<span id="cb193-2"><a href="more-dplyr.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="more-dplyr.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb193-4"><a href="more-dplyr.html#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)</span>
<span id="cb193-5"><a href="more-dplyr.html#cb193-5" aria-hidden="true" tabindex="-1"></a>asia</span></code></pre></div>
<pre><code>## # A tibble: 396 x 3
## # Groups:   year [12]
##     year country     lifeExp
##    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;
##  1  1952 Afghanistan    28.8
##  2  1957 Afghanistan    30.3
##  3  1962 Afghanistan    32.0
##  4  1967 Afghanistan    34.0
##  5  1972 Afghanistan    36.1
##  6  1977 Afghanistan    38.4
##  7  1982 Afghanistan    39.9
##  8  1987 Afghanistan    40.8
##  9  1992 Afghanistan    41.7
## 10  1997 Afghanistan    41.8
## # … with 386 more rows</code></pre>
<p>Now we apply a window function: <code>min_rank()</code>. Since <code>asia</code> is grouped by year, <code>min_rank()</code> operates within mini-datasets, each for a specific year. Applied to the variable <code>lifeExp</code>, <code>min_rank()</code> returns the rank of each country’s observed life expectancy.</p>
<p>FYI, the <code>min</code> part just specifies how ties are broken. Here is an explicit peek at these within-year life expectancy ranks, in both the (default) ascending and descending order. If you specify <code>rank()</code>, ties will be denoted by .5. For instance:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="more-dplyr.html#cb195-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb195-2"><a href="more-dplyr.html#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min_rank</span>(x)</span></code></pre></div>
<pre><code>## [1] 1 2 3 3 5</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="more-dplyr.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rank</span>(x)</span></code></pre></div>
<pre><code>## [1] 1.0 2.0 3.5 3.5 5.0</code></pre>
<p>For concreteness, I use <code>mutate()</code> to actually create these variables, even though I dropped this in the solution above. Let’s look at a bit of that.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="more-dplyr.html#cb199-1" aria-hidden="true" tabindex="-1"></a>asia <span class="sc">%&gt;%</span></span>
<span id="cb199-2"><a href="more-dplyr.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">le_rank =</span> <span class="fu">min_rank</span>(lifeExp),</span>
<span id="cb199-3"><a href="more-dplyr.html#cb199-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">le_desc_rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(lifeExp))) <span class="sc">%&gt;%</span> </span>
<span id="cb199-4"><a href="more-dplyr.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Thailand&quot;</span>), year <span class="sc">&gt;</span> <span class="dv">1995</span>)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 5
## # Groups:   year [3]
##    year country     lifeExp le_rank le_desc_rank
##   &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;int&gt;        &lt;int&gt;
## 1  1997 Afghanistan    41.8       1           33
## 2  2002 Afghanistan    42.1       1           33
## 3  2007 Afghanistan    43.8       1           33
## 4  1997 Japan          80.7      33            1
## 5  2002 Japan          82        33            1
## 6  2007 Japan          82.6      33            1
## 7  1997 Thailand       67.5      12           22
## 8  2002 Thailand       68.6      12           22
## 9  2007 Thailand       70.6      12           22</code></pre>
<p>Afghanistan tends to present 1’s in the <code>le_rank</code> variable, Japan tends to present 1’s in the <code>le_desc_rank</code> variable and other countries, like Thailand, present less extreme ranks.</p>
<p>You can understand the original <code>filter()</code> statement now:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="more-dplyr.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">min_rank</span>(<span class="fu">desc</span>(lifeExp)) <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">|</span> <span class="fu">min_rank</span>(lifeExp) <span class="sc">&lt;</span> <span class="dv">2</span>)</span></code></pre></div>
<p>These two sets of ranks are formed on-the-fly, within year group, and <code>filter()</code> retains rows with rank less than 2, which means … the row with rank = 1. Since we do for ascending and descending ranks, we get both the min and the max.</p>
<p>If we had wanted just the min OR the max, an alternative approach using <code>top_n()</code> would have worked.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="more-dplyr.html#cb202-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="more-dplyr.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Asia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-3"><a href="more-dplyr.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb202-4"><a href="more-dplyr.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb202-5"><a href="more-dplyr.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb202-6"><a href="more-dplyr.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#top_n(1, wt = lifeExp)       ## gets the max</span></span>
<span id="cb202-7"><a href="more-dplyr.html#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>, <span class="at">wt =</span> <span class="fu">desc</span>(lifeExp))  <span class="do">## gets the min</span></span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [12]
##     year country     lifeExp
##    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;
##  1  1952 Afghanistan    28.8
##  2  1957 Afghanistan    30.3
##  3  1962 Afghanistan    32.0
##  4  1967 Afghanistan    34.0
##  5  1972 Afghanistan    36.1
##  6  1977 Cambodia       31.2
##  7  1982 Afghanistan    39.9
##  8  1987 Afghanistan    40.8
##  9  1992 Afghanistan    41.7
## 10  1997 Afghanistan    41.8
## 11  2002 Afghanistan    42.1
## 12  2007 Afghanistan    43.8</code></pre>
</div>
</div>
<div id="introduction-to-visualization-optional" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Introduction to visualization (OPTIONAL)</h2>
<p>Although we will get into more serious plotting in future chapters, I want to give you a taste of the excitement to come.</p>
<p>Here, we will get sampling of the almighty <code>ggplot2</code> package. Let’s look at a few basic examples.</p>
<p>If you want to compare continuous data with a few categories, either a bar plot or box plot would be a good bet. Let’s look at the 1952 gapminder data.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="more-dplyr.html#cb204-1" aria-hidden="true" tabindex="-1"></a>dat<span class="fl">.1952</span> <span class="ot">&lt;-</span> my_gap <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1952</span>)</span>
<span id="cb204-2"><a href="more-dplyr.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat<span class="fl">.1952</span>, <span class="fu">aes</span>(<span class="at">x=</span>continent, <span class="at">y=</span>lifeExp)) <span class="sc">+</span></span>
<span id="cb204-3"><a href="more-dplyr.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binaxis =</span> <span class="st">&quot;y&quot;</span>, <span class="at">stackdir =</span> <span class="st">&quot;center&quot;</span>, <span class="at">dotsize =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb204-4"><a href="more-dplyr.html#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha=</span><span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>## `stat_bindot()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Look at this figure, what would you comment on the mean and variance of the data? Have you identified any outliers?</p>
<p>Now suppose we had no idea about what our data looks like, but we want to check the relationship between 2 continuous variables. A great place to start would be a scatter plot:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="more-dplyr.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat<span class="fl">.1952</span>, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp)) <span class="sc">+</span></span>
<span id="cb206-2"><a href="more-dplyr.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>The scatter plot shows an upwards relationship—we will quantify this correlation in a future chapter.</p>
<p>To make <code>gdpPercap</code> look more like a straight line, we can plot it in a base 10 log scale using the function <code>scale_x_log10()</code>. While we’re at it, let’s also add colours to label different continents.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="more-dplyr.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat<span class="fl">.1952</span>, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp)) <span class="sc">+</span></span>
<span id="cb207-2"><a href="more-dplyr.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> continent)) <span class="sc">+</span></span>
<span id="cb207-3"><a href="more-dplyr.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>We can also remove the grey background by setting the theme:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="more-dplyr.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat<span class="fl">.1952</span>, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp)) <span class="sc">+</span></span>
<span id="cb208-2"><a href="more-dplyr.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> continent)) <span class="sc">+</span></span>
<span id="cb208-3"><a href="more-dplyr.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb208-4"><a href="more-dplyr.html#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>Don’t worry too much about figures right now. We will cover data visualization in much more depth in future lessons.</p>
</div>
<div id="comprehensive-practice" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Comprehensive practice</h2>
<p>So let’s answer a “simple” question: which country experienced the sharpest 5-year drop in life expectancy (<code>le</code>)? Recall that this excerpt of the gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints.</p>
<p>At this point, the question is just too easy to answer, so find life expectancy by continent while we’re at it.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="more-dplyr.html#cb209-1" aria-hidden="true" tabindex="-1"></a>my_gap <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="more-dplyr.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, continent, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="more-dplyr.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, country) <span class="sc">%&gt;%</span></span>
<span id="cb209-4"><a href="more-dplyr.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within country, take (lifeExp in year i) - (lifeExp in year i - 1)</span></span>
<span id="cb209-5"><a href="more-dplyr.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># positive means lifeExp went up, negative means it went down</span></span>
<span id="cb209-6"><a href="more-dplyr.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">le_delta =</span> lifeExp <span class="sc">-</span> <span class="fu">lag</span>(lifeExp)) <span class="sc">%&gt;%</span> </span>
<span id="cb209-7"><a href="more-dplyr.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within country, retain the worst lifeExp change = smallest or most negative</span></span>
<span id="cb209-8"><a href="more-dplyr.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">worst_le_delta =</span> <span class="fu">min</span>(le_delta, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb209-9"><a href="more-dplyr.html#cb209-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within continent, retain the row with the lowest worst_le_delta</span></span>
<span id="cb209-10"><a href="more-dplyr.html#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">wt =</span> worst_le_delta) <span class="sc">%&gt;%</span> </span>
<span id="cb209-11"><a href="more-dplyr.html#cb209-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(worst_le_delta)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;continent&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 5 x 3
## # Groups:   continent [5]
##   continent country     worst_le_delta
##   &lt;fct&gt;     &lt;fct&gt;                &lt;dbl&gt;
## 1 Africa    Rwanda             -20.4  
## 2 Asia      Cambodia            -9.10 
## 3 Americas  El Salvador         -1.51 
## 4 Europe    Montenegro          -1.46 
## 5 Oceania   Australia            0.170</code></pre>
<p>Now this data is interesting. Take a look at the life expectancy in Rwanda in 1987 and in 1992.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="more-dplyr.html#cb212-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb212-2"><a href="more-dplyr.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, year, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb212-3"><a href="more-dplyr.html#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1987</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">1992</span>, country <span class="sc">==</span> <span class="st">&#39;Rwanda&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   country  year lifeExp
##   &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;
## 1 Rwanda   1987    44.0
## 2 Rwanda   1992    23.6</code></pre>
<p>Ponder the real-life implications of this output for a while. What you’re seeing here is genocide in dry statistics on average life expectancy.</p>
</div>
<div id="data-wrangling-summary" class="section level2" number="6.8">
<h2><span class="header-section-number">6.8</span> Data wrangling summary</h2>
<p>Wow, we covered <em>a lot</em> of data wrangling! Don’t wory if you don’t understand everything the first time around. Programming takes practice, and practice makes perfect. Here are some general remarks:</p>
<ol style="list-style-type: decimal">
<li>Break your code into pieces starting at the top, and inspect the intermediate results. That’s certainly how I was able to <em>write</em> such a thing.</li>
<li>The commands presented in this lab do not <a href="http://tinyurl.com/athenaforehead">leap fully formed out of anyone’s forehead</a>—they are built up gradually, with lots of errors and refinements along the way.</li>
<li>If your statements are difficult to read, by all means break it into pieces and make some intermediate objects. Your code should be easy to read and write when you’re done.</li>
</ol>
<p>The functions presented here should cover most of your basic data wrangling needs. If you ever need to do something more complicated, search it up! Although I have programmed for many years, I still need to do a quick Google search for documentation and StackOverflow solutions.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="gapminder-and-dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="central-limit-theorem.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
